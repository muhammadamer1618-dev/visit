<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>نموذج الزيارة الصفّية</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
<style>
*{box-sizing:border-box;font-family:'Cairo',sans-serif}
body{margin:0;background:linear-gradient(135deg,#0d47a1,#1976d2)}
.wrap{max-width:1100px;margin:0 auto;padding:18px}
.card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 15px 40px rgba(0,0,0,.18)}
h2{text-align:center;color:#0d47a1;margin-top:0}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px;text-align:center;font-size:14px}
th{background:#f4f4f4}
textarea{width:100%;min-height:80px;padding:10px;border-radius:10px;border:1px solid #ccc}
.btn{margin-top:14px;background:#1976d2;color:#fff;border:0;padding:12px 18px;border-radius:12px;font-size:15px;cursor:pointer}
.msg{margin-top:10px;color:#b71c1c}
.footer{text-align:center;margin-top:14px;color:#666}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h2>استمارة تبادل زيارة صفّية</h2>

    <table>
      <thead>
        <tr>
          <th>م</th>
          <th>البند</th>
          <th>ممتاز</th>
          <th>جيد</th>
          <th>متوسط</th>
          <th>إلى حد ما</th>
          <th>لم ينفذ</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>

    <br>
    <label>الملاحظات الإيجابية</label>
    <textarea id="positiveNotes"></textarea>

    <br><br>
    <label>التوصيات</label>
    <textarea id="recommendations"></textarea>

    <button class="btn" id="saveBtn">حفظ النموذج</button>
    <div class="msg" id="msg"></div>
  </div>

  <div class="footer">تصميم محمد عامر أحمد</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBbUryd9blqEG60L15-L_wU8-NORoHq4r4",
  authDomain: "visit-2026.firebaseapp.com",
  projectId: "visit-2026"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const visitId = sessionStorage.getItem("currentVisitId");
const msg = document.getElementById("msg");

if(!visitId){
  msg.textContent = "لا يوجد رقم زيارة محفوظ، الرجاء البدء من صفحة المعلم";
  document.getElementById("saveBtn").disabled = true;
}

const questions = [
"وضوح أهداف الدرس","تسلسل خطوات الدرس","وضوح مخارج الصوت","مناسبة طريقة التدريس",
"جودة الأسئلة","توزيع الأسئلة","تقبل مشاركات الطلاب","جذب الانتباه",
"التشجيع والتعزيز","تمكن المعلم","استثمار الوقت","شخصية المعلم",
"مظهر المعلم","ضبط الطلاب","استخدام السبورة","استخدام الوسائل",
"تقويم الدرس","رصد المشاركات"
];

const rows = document.getElementById("rows");
questions.forEach((q,i)=>{
  const tr=document.createElement("tr");
  tr.innerHTML = `
    <td>${i+1}</td>
    <td style="text-align:right">${q}</td>
    ${["ممتاز","جيد","متوسط","إلى حد ما","لم ينفذ"].map(v=>`
      <td><input type="radio" name="q${i}" value="${v}"></td>
    `).join("")}
  `;
  rows.appendChild(tr);
});

document.getElementById("saveBtn").onclick = async ()=>{
  msg.textContent="";
  const answers={};

  for(let i=0;i<questions.length;i++){
    const sel=document.querySelector(`input[name="q${i}"]:checked`);
    if(!sel){ msg.textContent="يرجى استكمال جميع البنود"; return; }
    answers["q"+(i+1)] = sel.value;
  }

  try{
    await updateDoc(doc(db,"visits",visitId),{
      formAnswers: answers,
      positiveNotes: positiveNotes.value,
      recommendations: recommendations.value,
      status: "submitted"
    });

    alert("تم حفظ النموذج بنجاح");
    location.href="index.html";
  }catch(e){
    msg.textContent="فشل الحفظ، تأكد من الاتصال";
  }
};
</script>
</body>
</html>
