<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>نموذج الزيارة الصفّية</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Cairo',sans-serif}
body{margin:0;min-height:100vh;background:linear-gradient(135deg,#0d47a1,#1976d2)}
.wrap{max-width:1100px;margin:0 auto;padding:18px}
.card{background:#fff;border-radius:16px;padding:16px;box-shadow:0 15px 40px rgba(0,0,0,.18)}
h2{text-align:center;margin-top:0;color:#0d47a1}
table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #ccc;padding:8px;text-align:center;font-size:14px}
th{background:#f4f4f4}
label{font-size:14px;font-weight:700}
textarea{width:100%;min-height:80px;padding:10px;border-radius:10px;border:1px solid #ccc}
.btn{margin-top:14px;background:#1976d2;color:#fff;border:0;padding:12px 18px;border-radius:12px;font-size:15px;cursor:pointer}
.msg{margin-top:10px;color:#b71c1c;min-height:18px}
.footer{text-align:center;margin-top:14px;color:#666}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">

    <h2>استمارة تبادل زيارة صفّية</h2>

    <table id="evalTable">
      <thead>
        <tr>
          <th>م</th>
          <th>المجال</th>
          <th>ممتاز</th>
          <th>جيد</th>
          <th>متوسط</th>
          <th>إلى حد ما</th>
          <th>لم ينفذ</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <br>
    <label>الملاحظات الإيجابية للمعلم الزائر</label>
    <textarea id="positiveNotes"></textarea>

    <br><br>
    <label>التوصيات التي يوصي بها المعلم الزائر</label>
    <textarea id="recommendations"></textarea>

    <button class="btn" id="saveBtn">حفظ النموذج</button>
    <div class="msg" id="msg"></div>

  </div>

  <div class="footer">تصميم محمد عامر أحمد</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, doc, updateDoc } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

/* Firebase */
const app = initializeApp({
  apiKey: "AIzaSyBbUryd9blqEG60L15-L_wU8-NORoHq4r4",
  authDomain: "visit-2026.firebaseapp.com",
  projectId: "visit-2026"
});
const db = getFirestore(app);

/* get visit id from URL */
const params = new URLSearchParams(window.location.search);
const visitId = params.get("id");

/* elements */
const msg = document.getElementById("msg");
const positiveNotes = document.getElementById("positiveNotes");
const recommendations = document.getElementById("recommendations");
const saveBtn = document.getElementById("saveBtn");

/* guard */
if(!visitId){
  msg.textContent = "رقم الزيارة غير موجود – الرجاء الرجوع لصفحة المعلم";
  saveBtn.disabled = true;
}

/* questions */
const questions = [
  "وضوح أهداف الدرس",
  "تسلسل خطوات الدرس",
  "وضوح مخارج الصوت",
  "مناسبة طريقة التدريس",
  "جودة الأسئلة التي تُلقى على الطلاب",
  "مهارة توزيع الأسئلة على الطلاب",
  "تقبل المعلم لآراء ومشاركات الطلاب",
  "جذب انتباه الطلاب",
  "استخدام عبارات التشجيع والتعزيز للطلاب",
  "تمكن المعلم من المادة العلمية",
  "استثمار وقت الحصة",
  "شخصية المعلم",
  "مظهر المعلم",
  "ضبط الطلاب",
  "استخدام السبورة وتنظيمها",
  "استخدام الوسائل المناسبة للدرس",
  "تقويم الدرس في نهاية الحصة",
  "رصد وتسجيل مشاركات وإجابات الطلاب"
];

/* render table */
const tbody = document.querySelector("#evalTable tbody");
questions.forEach((q,i)=>{
  const tr = document.createElement("tr");
  tr.innerHTML = `
    <td>${i+1}</td>
    <td style="text-align:right">${q}</td>
    ${["ممتاز","جيد","متوسط","إلى حد ما","لم ينفذ"].map(v=>`
      <td><input type="radio" name="q${i}" value="${v}"></td>
    `).join("")}
  `;
  tbody.appendChild(tr);
});

/* save */
saveBtn.onclick = async ()=>{
  if(!visitId) return;

  msg.textContent = "";
  const answers = {};

  for(let i=0;i<questions.length;i++){
    const sel = document.querySelector(`input[name="q${i}"]:checked`);
    if(!sel){
      msg.textContent = "يرجى استكمال جميع البنود";
      return;
    }
    answers["q"+(i+1)] = sel.value;
  }

  try{
    await updateDoc(doc(db,"visits",visitId),{
      formAnswers: answers,
      positiveNotes: positiveNotes.value.trim(),
      recommendations: recommendations.value.trim(),
      status: "submitted"
    });

    alert("تم حفظ نموذج الزيارة بنجاح");
    location.href = "index.html";
  }catch(e){
    msg.textContent = "فشل الحفظ – تأكد من قواعد Firestore";
  }
};
</script>

</body>
</html>
