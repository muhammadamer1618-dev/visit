<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>زياراتي السابقة</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Cairo',sans-serif}
body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#e3f2fd,#b3e5fc);
}

.wrap{max-width:1100px;margin:0 auto;padding:20px}

.card{
  background:#fff;
  border-radius:16px;
  padding:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.15)
}

h2{
  text-align:center;
  color:#0d47a1;
  margin-top:0;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:16px;
}

th,td{
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
  font-size:14px;
  color:#000
}

th{
  background:#e1f5fe;
  font-weight:700
}

.btn{
  background:#f57c00;
  color:#fff;
  border:0;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
}

.btn:hover{
  background:#ef6c00;
}

.footer{
  text-align:center;
  margin-top:18px;
  color:#333;
  font-size:14px
}
</style>
</head>

<body>

<div class="wrap">
  <div class="card">
    <h2>زياراتي السابقة</h2>

    <table>
      <thead>
        <tr>
          <th>التاريخ</th>
          <th>اليوم</th>
          <th>المعلم المُزار</th>
          <th>الفصل</th>
          <th>الحصة</th>
          <th>طباعة</th>
        </tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

  <div class="footer">مدارس الفلاح الأهلية</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { getFirestore, collection, getDocs, query, where }
from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

const app = initializeApp({
  apiKey: "AIzaSyBbUryd9blqEG60L15-L_wU8-NORoHq4r4",
  authDomain: "visit-2026.firebaseapp.com",
  projectId: "visit-2026"
});
const db = getFirestore(app);

/* get teacher id from url */
const params = new URLSearchParams(window.location.search);
const teacherId = params.get("tid");

if(!teacherId){
  alert("رابط غير صحيح");
}

/* load visits */
async function loadVisits(){

  const tbody = document.getElementById("rows");
  tbody.innerHTML="";

  const q = query(
    collection(db,"visits"),
    where("visitorTeacherId","==",teacherId)
  );

  const res = await getDocs(q);

  res.forEach(docSnap=>{
    const v = docSnap.data();

    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${v.visitDate || ""}</td>
      <td>${v.visitDay || ""}</td>
      <td>${v.visitedTeacherName || ""}</td>
      <td>${v.classText || ""}</td>
      <td>${v.periodText || ""}</td>
      <td>
        <button class="btn"
          onclick="window.open('visit-print.html?id=${docSnap.id}')">
          طباعة
        </button>
      </td>
    `;

    tbody.appendChild(tr);
  });
}

loadVisits();
</script>

</body>
</html>
